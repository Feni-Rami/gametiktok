<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Ball Arena Fight</title>
<style>
html,body{
  margin:0;
  background:#020204;
  overflow:hidden;
  font-family:Arial,Helvetica,sans-serif;
}
canvas{display:block}

/* HUD â€“ plus bas */
#hud{
  position:fixed;
  bottom:14px;
  left:0;right:0;
  display:flex;
  justify-content:space-between;
  padding:0 20px;
  font-size:18px;
  pointer-events:none;
}
.orange{color:#ff9f00}
.blue{color:#00baff}

/* End overlay */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  color:#fff;
  font-size:28px;
  z-index:10;
}
.hidden{display:none}
</style>
</head>
<body>

<div id="hud">
  <div class="orange">ORANGE <span id="sO">0</span></div>
  <div class="blue">BLUE <span id="sB">0</span></div>
</div>

<div id="end" class="overlay hidden">
  <div id="winner"></div>
</div>

<canvas id="c"></canvas>

<script>
/* ================= SETUP ================= */
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
resize();addEventListener("resize",resize);

const ARENA_SIZE = 260;
const BALL_RADIUS = 9; // â¬…ï¸ PLUS GRAND

/* ================= AUDIO ================= */
let audioCtx,audioReady=false;
function unlockAudio(){
  if(audioReady) return;
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  audioReady=true;
}
window.addEventListener("pointerdown",unlockAudio,{once:true});

function play(freq,dur,gain){
  if(!audioReady) return;
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.type="triangle";
  o.frequency.value=freq;
  g.gain.setValueAtTime(0,audioCtx.currentTime);
  g.gain.linearRampToValueAtTime(gain,audioCtx.currentTime+.01);
  g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+dur);
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+dur);
}
const bounce=()=>play(260,0.03,0.06);
const pickup=()=>play(320,0.05,0.1);
const kill=()=>play(140,0.15,0.2);

/* ================= STATE ================= */
let balls=[], weapon=null;
let scoreO=0, scoreB=0;
let running=true;

/* ================= INIT ================= */
function resetRound(){
  balls=[
    {x:-70,y:0,vx:2.2,vy:1.8,color:"orange",weapon:null,weaponTime:0},
    {x: 70,y:0,vx:-2.2,vy:-1.8,color:"blue",weapon:null,weaponTime:0}
  ];
  weapon=null;
}
resetRound();

/* ================= WEAPONS ================= */
function spawnWeapon(){
  const types=["knife","gun","saw"];
  weapon={
    type:types[Math.floor(Math.random()*3)],
    x:(Math.random()*160-80),
    y:(Math.random()*160-80),
    time:360,
    taken:false
  };
}

/* ================= UI ================= */
const sO=document.getElementById("sO");
const sB=document.getElementById("sB");
function updateScore(){
  sO.textContent=scoreO;
  sB.textContent=scoreB;
}

/* ================= UPDATE ================= */
function update(){
  if(!running) return;

  /* spawn weapon */
  if(!weapon && Math.random()<0.01) spawnWeapon();
  if(weapon){
    weapon.time--;
    if(weapon.time<=0) weapon=null;
  }

  /* move balls */
  for(const b of balls){
    b.x+=b.vx;
    b.y+=b.vy;

    if(Math.abs(b.x)>ARENA_SIZE/2-BALL_RADIUS) b.vx*=-1;
    if(Math.abs(b.y)>ARENA_SIZE/2-BALL_RADIUS) b.vy*=-1;

    if(b.weapon){
      b.weaponTime--;
      if(b.weaponTime<=0) b.weapon=null;
    }
  }

  /* BALL â†” BALL â€” PHYSIQUE NORMALE */
  const a=balls[0], b=balls[1];
  const dx=b.x-a.x, dy=b.y-a.y;
  const d=Math.hypot(dx,dy);

  if(d < BALL_RADIUS*2){
    const nx=dx/d, ny=dy/d;

    /* sÃ©paration (Ã©vite collage) */
    const overlap = BALL_RADIUS*2 - d;
    a.x -= nx * overlap/2;
    a.y -= ny * overlap/2;
    b.x += nx * overlap/2;
    b.y += ny * overlap/2;

    /* Ã©change de vitesse (Ã©lastique) */
    const dvx=a.vx-b.vx;
    const dvy=a.vy-b.vy;
    const impact = dvx*nx + dvy*ny;

    if(impact > 0){
      a.vx -= impact * nx;
      a.vy -= impact * ny;
      b.vx += impact * nx;
      b.vy += impact * ny;
      bounce();
    }
  }

  /* weapon pickup */
  if(weapon && !weapon.taken){
    for(const b of balls){
      if(Math.hypot(b.x-weapon.x,b.y-weapon.y)<BALL_RADIUS+8){
        weapon.taken=true;
        b.weapon=weapon.type;
        b.weaponTime=360;
        weapon=null;
        pickup();
        break;
      }
    }
  }

  /* combat ONLY if weapon */
  if(d < BALL_RADIUS*2){
    if(a.weapon && !b.weapon){
      scoreO++; resetRound(); kill();
    } else if(b.weapon && !a.weapon){
      scoreB++; resetRound(); kill();
    }
    updateScore();
  }

  /* win */
  if(scoreO>=6 || scoreB>=6){
    document.getElementById("winner").textContent =
      scoreO>scoreB ? "ORANGE WINS" : "BLUE WINS";
    document.getElementById("end").classList.remove("hidden");
    running=false;
  }
}

/* ================= DRAW ================= */
function drawWeaponIcon(w){
  ctx.save();
  ctx.translate(w.x,w.y);
  ctx.strokeStyle="#fff";
  ctx.lineWidth=2;

  if(w.type==="knife"){
    ctx.beginPath();
    ctx.moveTo(-6,-6); ctx.lineTo(6,0); ctx.lineTo(-6,6);
    ctx.stroke();
  }
  if(w.type==="gun"){
    ctx.strokeRect(-6,-2,8,4);
    ctx.strokeRect(2,0,4,4);
  }
  if(w.type==="saw"){
    ctx.beginPath();
    ctx.arc(0,0,6,0,Math.PI*2);
    for(let i=0;i<8;i++){
      const a=i*Math.PI/4;
      ctx.moveTo(Math.cos(a)*6,Math.sin(a)*6);
      ctx.lineTo(Math.cos(a)*9,Math.sin(a)*9);
    }
    ctx.stroke();
  }
  ctx.restore();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(canvas.width/2,canvas.height/2);

  ctx.strokeStyle="#ffffff33";
  ctx.strokeRect(-ARENA_SIZE/2,-ARENA_SIZE/2,ARENA_SIZE,ARENA_SIZE);

  if(weapon) drawWeaponIcon(weapon);

  for(const b of balls){
    ctx.beginPath();
    ctx.arc(b.x,b.y,BALL_RADIUS,0,Math.PI*2);
    ctx.fillStyle=b.color==="orange"?"#ff9f00":"#00baff";
    ctx.fill();

    if(b.weapon){
      ctx.strokeStyle="#fff";
      ctx.strokeRect(b.x-12,b.y-12,24,24);
    }
  }
  ctx.restore();
}

/* ================= LOOP ================= */
(function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>

<!-- <!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Ball Arena Fight</title>
<style>
html,body{
  margin:0;
  background:#020204;
  overflow:hidden;
  font-family:Arial,Helvetica,sans-serif;
}
canvas{display:block}

/* HUD */
#hud{
  position:fixed;
  top:10px;
  left:0;right:0;
  display:flex;
  justify-content:space-between;
  padding:0 20px;
  font-size:18px;
}
.orange{color:#ff9f00}
.blue{color:#00baff}

/* End overlay */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  color:#fff;
  font-size:28px;
  z-index:10;
}
.hidden{display:none}
</style>
</head>
<body>

<div id="hud">
  <div class="orange">ORANGE <span id="sO">0</span></div>
  <div class="blue">BLUE <span id="sB">0</span></div>
</div>

<div id="end" class="overlay hidden">
  <div id="winner"></div>
</div>

<canvas id="c"></canvas>

<script>
/* ================= SETUP ================= */
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
resize();addEventListener("resize",resize);

const ARENA_SIZE = 260;

/* ================= AUDIO ================= */
let audioCtx,audioReady=false;
function unlockAudio(){
  if(audioReady) return;
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  audioReady=true;
}
window.addEventListener("pointerdown",unlockAudio,{once:true});

function play(freq,dur,gain){
  if(!audioReady) return;
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.type="triangle";
  o.frequency.value=freq;
  g.gain.setValueAtTime(0,audioCtx.currentTime);
  g.gain.linearRampToValueAtTime(gain,audioCtx.currentTime+.01);
  g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+dur);
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+dur);
}
const hit=()=>play(320,.05,.1);
const kill=()=>play(140,.15,.2);

/* ================= STATE ================= */
let balls=[], weapon=null;
let scoreO=0, scoreB=0;
let running=true;

/* ================= INIT ================= */
function resetRound(){
  balls=[
    {x:-60,y:0,vx:2,vy:1.6,color:"orange",weapon:null,weaponTime:0},
    {x: 60,y:0,vx:-2,vy:-1.6,color:"blue",weapon:null,weaponTime:0}
  ];
  weapon=null;
}
resetRound();

/* ================= WEAPONS ================= */
function spawnWeapon(){
  const types=["knife","gun","saw"];
  weapon={
    type:types[Math.floor(Math.random()*3)],
    x:(Math.random()*160-80),
    y:(Math.random()*160-80),
    time:360,
    taken:false
  };
}

/* ================= UI ================= */
const sO=document.getElementById("sO");
const sB=document.getElementById("sB");
function updateScore(){
  sO.textContent=scoreO;
  sB.textContent=scoreB;
}

/* ================= UPDATE ================= */
function update(){
  if(!running) return;

  /* spawn weapon */
  if(!weapon && Math.random()<0.01) spawnWeapon();
  if(weapon){
    weapon.time--;
    if(weapon.time<=0) weapon=null;
  }

  for(const b of balls){
    b.x+=b.vx;
    b.y+=b.vy;

    if(Math.abs(b.x)>ARENA_SIZE/2) b.vx*=-1;
    if(Math.abs(b.y)>ARENA_SIZE/2) b.vy*=-1;

    if(b.weapon){
      b.weaponTime--;
      if(b.weaponTime<=0) b.weapon=null;
    }
  }

  /* weapon pickup (FIXED) */
  if(weapon && !weapon.taken){
    for(const b of balls){
      if(Math.hypot(b.x-weapon.x,b.y-weapon.y)<14){
        weapon.taken=true;
        b.weapon=weapon.type;
        b.weaponTime=360;
        weapon=null;
        hit();
        break;
      }
    }
  }

  /* combat */
  const a=balls[0], b=balls[1];
  if(Math.hypot(a.x-b.x,a.y-b.y)<10){
    if(a.weapon){
      scoreO++; resetRound(); kill();
    } else if(b.weapon){
      scoreB++; resetRound(); kill();
    }
    updateScore();
  }

  /* win */
  if(scoreO>=6||scoreB>=6){
    document.getElementById("winner").textContent =
      scoreO>scoreB?"ORANGE WINS":"BLUE WINS";
    document.getElementById("end").classList.remove("hidden");
    running=false;
  }
}

/* ================= DRAW ================= */
function drawWeaponIcon(w){
  ctx.save();
  ctx.translate(w.x,w.y);
  ctx.strokeStyle="#fff";
  ctx.lineWidth=2;

  if(w.type==="knife"){
    ctx.beginPath();
    ctx.moveTo(-6,-6); ctx.lineTo(6,0); ctx.lineTo(-6,6);
    ctx.stroke();
  }

  if(w.type==="gun"){
    ctx.strokeRect(-6,-2,8,4);
    ctx.strokeRect(2,0,4,4);
  }

  if(w.type==="saw"){
    ctx.beginPath();
    ctx.arc(0,0,6,0,Math.PI*2);
    for(let i=0;i<8;i++){
      const a=i*Math.PI/4;
      ctx.moveTo(Math.cos(a)*6,Math.sin(a)*6);
      ctx.lineTo(Math.cos(a)*9,Math.sin(a)*9);
    }
    ctx.stroke();
  }
  ctx.restore();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(canvas.width/2,canvas.height/2);

  ctx.strokeStyle="#ffffff33";
  ctx.strokeRect(-ARENA_SIZE/2,-ARENA_SIZE/2,ARENA_SIZE,ARENA_SIZE);

  if(weapon) drawWeaponIcon(weapon);

  for(const b of balls){
    ctx.beginPath();
    ctx.arc(b.x,b.y,6,0,Math.PI*2);
    ctx.fillStyle=b.color==="orange"?"#ff9f00":"#00baff";
    ctx.fill();

    if(b.weapon){
      ctx.strokeStyle="#fff";
      ctx.strokeRect(b.x-10,b.y-10,20,20);
    }
  }
  ctx.restore();
}

/* ================= LOOP ================= */
(function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html> -->

<!-- ------------------------------------------------------------------------------------------------------------------------------------------------- -->
<!-- cercle escape -->
<!-- <!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Escape Rings â€“ Final Stable</title>
<style>
html,body{
  margin:0;
  background:#020204;
  overflow:hidden;
  font-family:Arial,Helvetica,sans-serif;
}
canvas{display:block}

/* HUD */
#hud{
  position:fixed;
  top:14px;
  left:0; right:0;
  display:flex;
  justify-content:space-between;
  padding:0 20px;
  font-size:18px;
  pointer-events:none;
}
.orange{color:#ff9f00}
.blue{color:#00baff}

/* Overlays */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  color:#fff;
  font-size:28px;
  letter-spacing:1px;
  z-index:10;
}
.hidden{display:none}
.small{font-size:18px;opacity:.7}
</style>
</head>
<body>

<div id="hud">
  <div class="orange">ORANGE <span id="scoreO">0</span></div>
  <div class="blue">BLUE <span id="scoreB">0</span></div>
</div>

<div id="start" class="overlay">
  <div><span class="orange">ORANGE</span> VS <span class="blue">BLUE</span></div>
  <div class="small">Tap to start</div>
</div>

<div id="end" class="overlay hidden">
  <div id="winner"></div>
  <div class="small">Restartingâ€¦</div>
</div>

<canvas id="c"></canvas>

<script>
/* ================= SETUP ================= */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
resize();addEventListener("resize",resize);

const CX=()=>canvas.width/2;
const CY=()=>canvas.height/2;

/* ================= AUDIO ================= */
let audioCtx, audioReady=false, pitchLevel=0, cameraPulse=0;

function initAudio(){
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  audioReady=true;
}

/* âœ… SON CHOISI (NE PAS MODIFIER) */
function play(freq, dur, gain){
  if(!audioReady) return;

  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();

  o.type = "triangle";
  o.frequency.value = freq;

  g.gain.setValueAtTime(0, audioCtx.currentTime);
  g.gain.linearRampToValueAtTime(gain, audioCtx.currentTime + 0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);

  o.connect(g);
  g.connect(audioCtx.destination);

  o.start();
  o.stop(audioCtx.currentTime + dur);
}

const bounceSound=()=>play(220,.04,.08);
const hitSound=()=>play(300,.04,.1);
const exitSound=()=>{
  play(520+pitchLevel*120,.09,.18);
  pitchLevel++;
  cameraPulse=1;
};

/* ================= SETTINGS ================= */
const RING_COUNT=13;
const GAP_SIZE=Math.PI/7;
const RING_THICKNESS=4;
const SAFE_MARGIN=-45;

const BALL_RADIUS=3.5;
const BALL_SPEED=6.2;
const BALL_COUNT=2;

const BASE_ROT_SPEED=.0025;
const BOUNCE_RANDOM_ANGLE=Math.PI/18;

function getMaxRadius(){
  return Math.min(canvas.width,canvas.height)/2 - SAFE_MARGIN;
}

/* ================= STATE ================= */
let rings=[], balls=[], started=false;
let scoreO=0, scoreB=0;

/* ================= INIT ================= */
function reset(){
  rings=[]; balls=[]; pitchLevel=0;
  scoreO=0; scoreB=0;
  updateScore();

  const spacing=getMaxRadius()/(RING_COUNT+8);

  for(let i=0;i<RING_COUNT;i++){
    rings.push({
      r:spacing*(i+3),
      gap:Math.random()*Math.PI*2,
      rot:BASE_ROT_SPEED*(i+1)
    });
  }

  for(let i=0;i<BALL_COUNT;i++){
    const a=Math.random()*Math.PI*2;
    balls.push({
      x:CX()+Math.cos(a)*30,
      y:CY()+Math.sin(a)*30,
      vx:Math.cos(a+i)*BALL_SPEED,
      vy:Math.sin(a+i)*BALL_SPEED,
      color:i===0?"orange":"blue",
      prevD:0 // ðŸ”‘ FIX TUNNELING
    });
  }
}

/* ================= UI ================= */
const scoreOEl=document.getElementById("scoreO");
const scoreBEl=document.getElementById("scoreB");
function updateScore(){
  scoreOEl.textContent=scoreO;
  scoreBEl.textContent=scoreB;
}

/* ================= START ================= */
document.getElementById("start").onclick=()=>{
  initAudio();
  reset();
  started=true;
  document.getElementById("start").classList.add("hidden");
};

/* ================= HELPERS ================= */
const dist=(ax,ay,bx,by)=>Math.hypot(ax-bx,ay-by);
const angle=(x,y)=>Math.atan2(y-CY(),x-CX());
function norm(a){
  while(a<-Math.PI)a+=Math.PI*2;
  while(a>Math.PI)a-=Math.PI*2;
  return a;
}

/* ================= UPDATE ================= */
function update(){
  if(!started) return;

  /* mÃ©morise distance prÃ©cÃ©dente (FIX) */
  for(const b of balls){
    b.prevD = dist(b.x,b.y,CX(),CY());
  }

  for(const b of balls){
    b.x+=b.vx;
    b.y+=b.vy;
  }

  /* Ball â†” Ball */
  if(balls.length===2){
    const a=balls[0], b=balls[1];
    const d=dist(a.x,a.y,b.x,b.y);
    if(d<BALL_RADIUS*2){
      const nx=(b.x-a.x)/d, ny=(b.y-a.y)/d;
      const p=(a.vx*nx+a.vy*ny-b.vx*nx-b.vy*ny);
      a.vx-=p*nx; a.vy-=p*ny;
      b.vx+=p*nx; b.vy+=p*ny;
      hitSound();
    }
  }

  /* Rings */
  for(let i=rings.length-1;i>=0;i--){
    const ring=rings[i];
    ring.gap+=ring.rot;

    for(const b of balls){
      const d=dist(b.x,b.y,CX(),CY());
      const a=angle(b.x,b.y);
      const diff=Math.abs(norm(a-ring.gap));

      const wasInside=b.prevD<ring.r;
      const isOutside=d>ring.r;

      /* âœ… PASSAGE VALIDE (mÃªme si on saute le rayon) */
      if(wasInside && isOutside && diff<GAP_SIZE/2){
        exitSound();
        if(b.color==="orange") scoreO++;
        else scoreB++;
        updateScore();
        rings.splice(i,1);
        return;
      }

      /* Collision classique */
      if(Math.abs(d-ring.r)<BALL_RADIUS+RING_THICKNESS && diff>GAP_SIZE/2){
        const nx=(b.x-CX())/d, ny=(b.y-CY())/d;
        const dot=b.vx*nx+b.vy*ny;
        const ang=Math.atan2(b.vy-2*dot*ny,b.vx-2*dot*nx);
        const rand=(Math.random()*2-1)*BOUNCE_RANDOM_ANGLE;
        b.vx=Math.cos(ang+rand)*BALL_SPEED;
        b.vy=Math.sin(ang+rand)*BALL_SPEED;
        bounceSound();
      }
    }
  }

  /* Fin */
  if(rings.length===0){
    const end=document.getElementById("end");
    const w=document.getElementById("winner");
    w.textContent = scoreO>scoreB ? "ORANGE WINS" :
                    scoreB>scoreO ? "BLUE WINS" : "DRAW";
    w.className = scoreO>=scoreB ? "orange" : "blue";
    end.classList.remove("hidden");
    setTimeout(()=>{
      end.classList.add("hidden");
      reset();
    },2000);
  }

  cameraPulse*=.9;
}

/* ================= DRAW ================= */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(CX(),CY());
  ctx.scale(1+cameraPulse*.05,1+cameraPulse*.05);
  ctx.translate(-CX(),-CY());

  const bg=ctx.createRadialGradient(CX(),CY(),60,CX(),CY(),canvas.width);
  bg.addColorStop(0,"#0b0d18");
  bg.addColorStop(1,"#020204");
  ctx.fillStyle=bg;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.lineWidth=RING_THICKNESS;
  ctx.shadowBlur=14;

  for(let i=0;i<rings.length;i++){
    const hue=280+i*6;
    ctx.strokeStyle=`hsl(${hue},90%,65%)`;
    ctx.shadowColor=ctx.strokeStyle;
    ctx.beginPath();
    ctx.arc(
      CX(),CY(),
      rings[i].r,
      rings[i].gap+GAP_SIZE/2,
      rings[i].gap+Math.PI*2-GAP_SIZE/2
    );
    ctx.stroke();
  }
  ctx.shadowBlur=0;

  for(const b of balls){
    ctx.beginPath();
    ctx.arc(b.x,b.y,BALL_RADIUS,0,Math.PI*2);
    ctx.fillStyle=b.color==="orange"?"#ff9f00":"#00baff";
    ctx.fill();
  }
  ctx.restore();
}

/* ================= LOOP ================= */
(function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html> -->
